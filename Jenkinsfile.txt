pipeline{
    agent any
    stages
        {
           stage('ShellScript_KillExistingProcess')
           {
                steps
                    {
                        sh '''
                        #!/bin/bash
                        #this script is to automate kill process
                        arr=$(pgrep rasa)
                        echo "$arr"
                        IFS=$'\n'
                        for i in $arr
                        do
                            kill $i
                        done
                        '''
                    }
             }
           stage('Rasa_Train')
           {
                steps
                    {
                        sh '''
                        #!/bin/bash
                        #this script is to automate kill process
                        conda init bash
                        chmod a+rwx models
                        rasa train
                        '''
                    }
             }
           stage('Rasa_Unit_Test')
           {
                steps
                    {
                        sh '''
                        #!/bin/bash
                        #this script is to automate kill process
                        rasa test
                        '''
                    }
             }  
             
                 
          stage('Start_RasaCore_RasaAction')
            {
            steps
                {                
                    sh '''
                    #!/bin/bash
                    #this script is to automate kill process
                    JENKINS_NODE_COOKIE=dontKillMe nohup rasa run --enable-api --cors "*" --debug &
                    JENKINS_NODE_COOKIE=dontKillMe nohup rasa run actions --debug &
                    '''
                }
            }
          stage('Selenium_Testing')
            {
            steps
                {
                sh 'pip install -r requirements.txt'
                sh 'chmod a+rwx Selenium_Webdriver/chromedriver'
                sh 'python Selenium_Webdriver/Unit_test.py' 
                }
            }
        }
    }
