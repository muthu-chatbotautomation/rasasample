pipeline{
    agent any
    stages{
           stage('ShellScript_KillExistingRasaProcess')
            {
            steps
                {
                sh '''
                #!/bin/bash
                #this script is to automate kill process
                arr=$(pgrep rasa)
                echo "$arr"
                IFS=$'\n'
                for i in $arr
                do
                    kill $i
                done
                '''
                }
                
            }
          stage('Rasa_Train')
          {
           steps
           {
              sh'''  
              conda init bash
              chmod a+rwx models
              rasa train
              '''
          }
          }
          stage('Unit_Testing')
          {
          steps
          {
          sh'rasa test'
          }
          }


          stage('Start_RasaCore_RasaAction')
          {
          steps
          {
               sh''' 
                #!/bin/bash
                #this script is to automate kill process
                BUILD_ID=dontKillMe nohup rasa run --enable-api --cors "*" --debug &
                BUILD_ID=dontKillMe nohup rasa run actions --debug &
                '''
          
          }
          }
          

      
        }
    }
